<!DOCTYPE html>
<html>

<head>
    <style>
        div {
            vertical-align: top;
        }

        #app {
            margin: auto;
            text-align: center;
        }

        #map,
        #player1Info,
        #player2Info,
        #legend,
        #InfoBlock {
            display: inline-block;
        }

        #chatLog {
            border: 2px solid black;
            min-height: 100px;
            overflow: auto;
            max-height: 300px;
            white-space: pre-line;
        }

        .tile {
            width: 50px;
            height: 50px;
            display: inline-block;
            border: 1px solid black;
        }

        .go {
            background-color: green;
        }

        .PlayerBlue,
        .PlayerRed {
            width: 100%;
            height: 100%;
        }

        .PlayerBlue {
            background-color: deepskyblue;
        }

        .PlayerRed {
            background-color: palevioletred;
        }

        .PlayerBlue.racist {
            background-color: plum;
        }

        .PlayerRed.racist {
            background-color: mediumspringgreen;
        }

        .cantgo {
            background-color: lightgray;
            border-color: grey;
        }

        .go:hover {
            cursor: pointer;
            background-color: greenyellow;
        }

        .go:active {
            border-width: 2px;
            width: 48px;
            height: 48px;
            background-color: #75c200;
        }

        .PlayerBlue.racist.selected,.PlayerRed.racist.selected,.selected {
            background-color: yellow;
        }

        img {
            width: 100%;
            height: 100%;
        }

        .legend {
            width: 20px;
            height: 20px;
        }

        table {
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid black;
            padding: 2px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>

<body>
    <div id="app">
        <table id="legend">
            <tr>
                <th>Piece</th>
                <th>Image</th>
                <th>Puissance</th>
            </tr>
            <tr>
                <td>MARSHAL</td>
                <td><img src="/img/marshal.svg" class="legend" /></td>
                <td>10 </td>
            </tr>
            <tr>
                <td>GENERAL</td>
                <td><img src="/img/general.svg" class="legend" /></td>
                <td>9</td>
            </tr>
            <tr>
                <td>COLONEL</td>
                <td><img src="/img/colonel.svg" class="legend" /></td>
                <td>8</td>
            </tr>
            <tr>
                <td>MAJOR</td>
                <td><img src="/img/major.svg" class="legend" /></td>
                <td>7</td>
            </tr>
            <tr>
                <td>CAPTAIN</td>
                <td><img src="/img/captain.svg" class="legend" /></td>
                <td>6</td>
            </tr>
            <tr>
                <td>LIEUTENANT</td>
                <td><img src="/img/lieutenant.svg" class="legend" /></td>
                <td>5</td>
            </tr>
            <tr>
                <td>SERGEANT</td>
                <td><img src="/img/sergeant.svg" class="legend" /></td>
                <td>4</td>
            </tr>
            <tr>
                <td>MINER</td>
                <td><img src="/img/miner.svg" class="legend" /></td>
                <td>3</td>
            </tr>
            <tr>
                <td>SCOUT</td>
                <td><img src="/img/scout.svg" class="legend" /></td>
                <td>2</td>
            </tr>
            <tr>
                <td>SPY</td>
                <td><img src="/img/spy.svg" class="legend" /></td>
                <td>1</td>
            </tr>
            <tr>
                <td>FLAG</td>
                <td><img src="/img/flag.svg" class="legend" /></td>
                <td>0</td>
            </tr>
            <tr>
                <td>BOMB</td>
                <td><img src="/img/bomb.svg" class="legend" /></td>
                <td>11</td>
            </tr>
        </table>

        <div v-html="datas.map" id="map">
        </div>
        <div style="display:inline-block" v-if="positioning && (datas.username1 == pid || datas.username2 == pid)">
            <input type="text" id="newName" placeholder="Change Username"/>
            <button onclick="socket.emit('changeName',newName.value);">Apply Changes</button>
        </div>
        <button v-if="positioning && (datas.username1 == pid || datas.username2 == pid)"
            onclick="btnEndPositiong_click()">End
            Positioning</button>
            <button v-if="!positioning && (datas.username1 == pid || datas.username2 == pid)"
                onclick="btnSurrend_click()">Surrend</button>


        <div id="InfoBlock">
            <div id="player2Info">
                <b v-if="datas.turn == datas.username2">Turn</b>
                <span v-else>Not turn</span>
                <div id="name2" v-if="pid == datas.username2"><b>{{ datas.username2 }}</b></div>
                <div id="name2" v-else>{{ datas.username2 }} </div>
                <div id="pieces2">
                    <div id="MARSHAL2">Remaining {{ datas.MARSHAL2 }} MARSHAL</div>
                    <div id="GENERAL2">Remaining {{ datas.GENERAL2 }} GENERAL</div>
                    <div id="COLONEL2">Remaining {{ datas.COLONEL2 }} COLONEL</div>
                    <div id="MAJOR2">Remaining {{ datas.MAJOR2 }} MAJOR</div>
                    <div id="CAPTAIN2">Remaining {{ datas.CAPTAIN2 }} CAPTAIN</div>
                    <div id="LIEUTENANT2">Remaining {{ datas.LIEUTENANT2 }} LIEUTENANT</div>
                    <div id="SERGEANT2">Remaining {{ datas.SERGEANT2 }} SERGEANT</div>
                    <div id="MINER2">Remaining {{ datas.MINER2 }} MINER</div>
                    <div id="SCOUT2">Remaining {{ datas.SCOUT2 }} SCOUT</div>
                    <div id="SPY2">Remaining {{ datas.SPY2 }} SPY</div>
                    <div id="FLAG2">Remaining {{ datas.FLAG2 }} FLAG</div>
                    <div id="BOMB2">Remaining {{ datas.BOMB2 }} BOMB</div>
                </div>
                <button id="btnClaim2" v-if="datas.canClaim2" onclick="ClaimJ(2)">Claim P2</button>
            </div>
            <div id="player1Info">
                <b v-if="datas.turn == datas.username1">Turn</b>
                <span v-else>Not turn</span>
                <div id="name1" v-if="pid == datas.username1"><b>{{ datas.username1 }}</b></div>
                <div id="name1" v-else>{{ datas.username1 }} </div>
                <div id="pieces1">
                    <div id="MARSHAL1">Remaining {{ datas.MARSHAL1 }} MARSHAL</div>
                    <div id="GENERAL1">Remaining {{ datas.GENERAL1 }} GENERAL</div>
                    <div id="COLONEL1">Remaining {{ datas.COLONEL1 }} COLONEL</div>
                    <div id="MAJOR1">Remaining {{ datas.MAJOR1 }} MAJOR</div>
                    <div id="CAPTAIN1">Remaining {{ datas.CAPTAIN1 }} CAPTAIN</div>
                    <div id="LIEUTENANT1">Remaining {{ datas.LIEUTENANT1 }} LIEUTENANT</div>
                    <div id="SERGEANT1">Remaining {{ datas.SERGEANT1 }} SERGEANT</div>
                    <div id="MINER1">Remaining {{ datas.MINER1 }} MINER</div>
                    <div id="SCOUT1">Remaining {{ datas.SCOUT1 }} SCOUT</div>
                    <div id="SPY1">Remaining {{ datas.SPY1 }} SPY</div>
                    <div id="FLAG1">Remaining {{ datas.FLAG1 }} FLAG</div>
                    <div id="BOMB1">Remaining {{ datas.BOMB1 }} BOMB</div>
                </div>
                <button id="btnClaim1" v-if="datas.canClaim1" onclick="ClaimJ(1)">Claim P1</button>
            </div>
            <div id="chatLog">
                {{ chatlog }}
            </div>
        </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var selectedX, selectedY;
        function Clicked(x, y, self) {
            if (app.positioning) {
                if (selectedX == null || selectedY == null) {
                    selectedX = x;
                    selectedY = y;
                    socket.emit('select',x,y);
                } else {
                        socket.emit('switch', x, y, selectedX, selectedY);
                        selectedX = null;
                        selectedY = null;

                }
            } else {
                selectedX = x;
                selectedY = y;
                socket.emit('whereCanGo', x, y);
            }
        }


        function Switch(x1, y1, x2, y2) {
        }

        function HeyMateGoHere(x, y) {
            socket.emit('heyMateGoHere', selectedX, selectedY, x, y);
        }

        const app = new Vue({
            el: '#app',
            data: {
                positioning: true,
                pid: 0,
                chatlog: "Welcome to the game",
                datas: { canClaim1: true, canClaim2: true }
            }
        })
        //SocketIO Connect
        var socket = io.connect('http://127.0.0.1:8080');

        socket.on('nameChanged',function(ancientId,newName){
            selectedY = null;
            selectedX = null;
            if(app.pid == ancientId){
                app.pid = newName;
            }
        });

        //Claim a Player to server
        function ClaimJ(player) {
            app.pid = socket.id;

            switch (player) {
                case 1:
                    socket.emit('claiming', player);

                    break;
                case 2:
                    socket.emit('claiming', player);

                    break;
                default:
                    break;
            }
        }

        function btnSurrend_click(){
            socket.emit('surrend');
        }
        socket.on('redrawMap', function (drawMap) {
            app.datas.map = drawMap;
        });
        //A player has claimed
        socket.on('RequestUpdate', function () {
            socket.emit('WantUpdate');
        });

        //Called when you are completely connected
        socket.on('Update', function (datas) {
            app.datas = datas;
        });

        //Called when you are completely connected
        socket.on('win', function (str) {
            app.datas.map = "<h1>" + str + "</h1>";
            app.chatlog = "Ah ouaiis!";
        });

        //Called when you are completely connected
        socket.on('chatlog', function (str) {
            app.chatlog += '\n' + str;
            console.log(str);
        });

        app.positioning = true;
        //When the server told us to begin positioning
        socket.on('beginPositioning', function () {
            //Positioning
            app.positioning = true;
            app.pid = socket.id;
        });

        function btnEndPositiong_click() {
            app.positioning = false;
            //Told the server that finished
            socket.emit('endPositioning');
        }
    </script>
</body>

</html>